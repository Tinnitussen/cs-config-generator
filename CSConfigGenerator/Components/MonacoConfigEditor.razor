@using BlazorMonaco.Editor
@inject IJSRuntime JSRuntime

<div class="monaco-editor-wrapper">
    <StandaloneCodeEditor @ref="_editor" Id="config-editor" ConstructionOptions="EditorConstructionOptions" OnDidInit="EditorOnDidInit" />
</div>

<style>
    .monaco-editor-wrapper {
        height: 100%;
        width: 100%;
        min-height: 400px;
        border: 1px solid #ccc;
    }
</style>

@code {
    private StandaloneCodeEditor _editor = null!;

    [Parameter]
    public TextModel? Model { get; set; }

    [Parameter]
    public EventCallback OnEditorInit { get; set; }

    private StandaloneEditorConstructionOptions EditorConstructionOptions(StandaloneCodeEditor editor)
    {
        return new StandaloneEditorConstructionOptions
        {
            AutomaticLayout = true,
            Language = "plaintext",
            Theme = "vs-dark",
            Minimap = new EditorMinimapOptions { Enabled = false }
        };
    }

    private async Task EditorOnDidInit()
    {
        if (Model != null)
        {
            await _editor.SetModel(Model);
        }

        await OnEditorInit.InvokeAsync();
    }

    protected override async Task OnParametersSetAsync()
    {
        if (_editor != null && Model != null)
        {
            // We need to check if the current model is different to avoid unnecessary calls
            // typically checking the uri is enough
            var currentModel = await _editor.GetModel();
            if (currentModel == null || currentModel.Uri != Model.Uri)
            {
                await _editor.SetModel(Model);
            }
        }
    }

    public async Task Layout()
    {
        if (_editor != null)
        {
            await _editor.Layout();
        }
    }
}
