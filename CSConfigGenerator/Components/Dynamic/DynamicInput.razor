@using CSConfigGenerator.Models
@using CSConfigGenerator.ViewModels

@if (!ViewModel.Command.UiData.HideFromDefaultView)
{
    <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <label class="form-label @(ViewModel.Setting.IsInConfigEditor ? "" : "text-muted")" for="@ViewModel.Command.Command">
                    @ViewModel.Command.UiData.Label
                </label>
                @if (!ViewModel.Setting.IsInConfigEditor)
                {
                    <span class="badge bg-secondary ms-2">Removed</span>
                }
            </div>
            @if (ViewModel.Setting.IsInConfigEditor)
            {
                <button class="btn btn-sm btn-outline-danger" @onclick="ViewModel.Remove">Remove</button>
            }
            else
            {
                <button class="btn btn-sm btn-outline-success" @onclick="ViewModel.Restore">Restore</button>
            }
        </div>

        @if (ViewModel.Setting.IsInConfigEditor)
        {
            @switch (ViewModel.Command.UiData.Type)
            {
                case SettingType.Bool:
                    <input type="checkbox" id="@ViewModel.Command.Command" class="form-check-input" @bind="BoolValue" />
                    break;
                case SettingType.Int:
                    <input type="number" id="@ViewModel.Command.Command" class="form-control" @bind="IntValue" @bind:event="oninput" />
                    break;
                case SettingType.Float:
                    <input type="number" id="@ViewModel.Command.Command" class="form-control" @bind="FloatValue" @bind:event="oninput" />
                    break;
                case SettingType.Enum:
                    <select id="@ViewModel.Command.Command" class="form-control" @bind="StringValue">
                        @if (ViewModel.Command.UiData.Options != null)
                        {
                            @foreach (var option in ViewModel.Command.UiData.Options)
                            {
                                <option value="@option.Key">@option.Value</option>
                            }
                        }
                    </select>
                    break;
                case SettingType.String:
                case SettingType.Action:
                case SettingType.UnknownNumeric:
                case SettingType.UnknownInteger:
                default:
                    <input type="text" id="@ViewModel.Command.Command" class="form-control" @bind="StringValue" spellcheck="false" />
                    break;
            }
        }

        <small class="form-text text-muted">Command: <code>@ViewModel.Command.Command</code></small>
    </div>
}


@code {
    [Parameter, EditorRequired]
    public SettingViewModel ViewModel { get; set; } = null!;

    private bool BoolValue
    {
        get => ViewModel.Value is bool b ? b : false; // Safely cast with pattern matching
        set => ViewModel.Value = value;
    }
    private int IntValue
    {
        get => ViewModel.Value is int i ? i : (ViewModel.Value is float f ? (int)f : 0); // Handle int or float and provide a default
        set => ViewModel.Value = value;
    }
    private float FloatValue
    {
        get => ViewModel.Value is float f ? f : (ViewModel.Value is int i ? (float)i : 0.0f); // Handle float or int and provide a default
        set => ViewModel.Value = value;
    }
    private string StringValue
    {
        get => ViewModel.Value?.ToString() ?? string.Empty; // Safely convert to string
        set => ViewModel.Value = value;
    }
}